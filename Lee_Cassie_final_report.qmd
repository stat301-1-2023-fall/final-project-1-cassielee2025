---
title: "Air Quality Indicators and Disease Prevalence Across the US"
subtitle: |
  | Final Project 
  | Data Science 1 with R (STAT 301-1)
author: "Cassie Lee"
date: today

format:
  html:
    toc: true
    embed-resources: true
    
execute:
  echo: false
  warning: false

code-fold: true

from: markdown+emoji 
---

::: {.callout-tip icon="false"}
## Github Repo Link

[Cassie's Final Project Github Repo Link](https://github.com/stat301-1-2023-fall/final-project-1-cassielee2025.git)
:::

```{r}
#| label: load-pckgs-data

library(tidyverse)
library(skimr)
library(sf)
library(patchwork)
library(viridis)
load("data/full_air_quality_data.rda")
```

# Introduction

Air pollution is the presence of sufficient quantities of contaminants in the atmosphere for a duration that is long enough to cause harm to human health.[^1] Air pollution mainly enters the body through the lungs, and while it mostly impacts the heart, lungs, and brain, it has the potential to affect other organs as well by traveling through the bloodstream.[^2]

[^1]: [Air quality and health](https://www.who.int/teams/environment-climate-change-and-health/air-quality-and-health/health-impacts)

[^2]: [Air quality and health](https://www.who.int/teams/environment-climate-change-and-health/air-quality-and-health/health-impacts)

In the EDA, I explore the relationships between air quality indicators, certain lung diseases, and how sociodemographic vulnerabilities affect the relationships between air quality and health in the United States (excluding territories). The goal of this analysis is to build a deeper understanding of how various air pollutants impact health across the United States.

I queried the data at the county level and downloaded from the CDC National Environmental Public Health Tracking Network interactive data explorer.[^3] This network was built to centralize environmental health data on the national, state, and county level across the United States.[^4]

[^3]: [CDC National Environmental Public Health Tracking Network](http://www.cdc.gov/ephtracking)

[^4]: [CDC National Environmental Public Health Tracking Network](http://www.cdc.gov/ephtracking)

The three central questions I explored in this analysis were:

1.  How are various air and environmental quality indicators related to each other?

2.  What are the most important indicators for determining the prevalence of asthma, cancer, and chronic obstructive pulmonary disease?

3.  How do sociodemographics like age, gender, race, and socioeconomic vulnerability affect the relationships between air quality and health outcomes?

# Data overview & quality

The air pollutants I selected includes the days over the ozone standard, the percent of days over the PM 2.5 standard, benzene, formaldehyde, acetaldehyde, carbon tetrachloride, and 1,3-butadiene pollution. The environmental quality indicators I selected includes the percent of people living near highways, the percent of public schools near highways, access to parks, and methods of transportation to work (walking, biking, driving alone, carpooling, public transportation, and none).

The indicators I selected for prevalence of lung diseases includes the crude prevalence of adult and child asthma, the crude and age adjusted rates of emergency department visits for asthma, age adjusted rates of lung and bronchus cancer, and the crude and age adjusted rates of chronic pulmonary obstructive disease.

The indicators of sociodemographic data I selected includes age, gender, race, and and the social vulnerability index[^5]. I compared sociodemographic characteristics of each county to other counties in the United States and used this to identify counties with comparatively higher percentages of vulnerable groups (Appendix A). I also identified the majority race demographic in each county.

[^5]: [CDC/ATSDR Social Vulnerability Index](https://www.atsdr.cdc.gov/placeandhealth/svi/index.html)

If available, I downloaded all data at the county level for 2018. Crude rates of child asthma and age adjusted rates of lung and bronchus cancer were only available at the state level. I downloaded data for the usual method of transportation to work for the time period of 2017 to 2021.

The final merged dataset includes 42 variables and 3144 observations matching each county and Washington DC. There are 4 identifying variables, 5 factor variables, 32 numeric variables, and one simple features geometry variable for mapping.

With the exception of Rio Arriba, Mexico, all counties have complete sociodemographic information. Rio Arriba, Mexico is missing data for the social vulnerability index. The prevalence of adult asthma is complete across all observations, but 1402 observations are missing for the prevalence of child asthma and 1789 observations are missing for crude and age adjusted emergency department visits for asthma. The majority of counties do not have information about the days over the ozone and PM 2.5 air quality standards. 1567 observations are missing data for the percent of public school near highways. All other variables are either complete or missing at most 1 observation.

# Explorations

## Indicators of air and environmental quality

As seen in @fig-days-over-distribution, the distribution of days over the ozone and particulate matter size 2.5 microns (PM 2.5) standards are both skewed right by observations with significantly more days over the standard. For both ozone and PM 2.5, most of the counties experienced no more than 20 days over the standard. However, the degree of right skewing for the distribution of days over ozone standard is significantly higher than for the distribution of days over the PM 2.5 standard.

```{r}
#| label: fig-days-over-distribution
#| fig-cap: Distribution of days over air quality standards.

p1 <- full_data %>% 
  ggplot(aes(days_over_o3_standard)) +
  geom_histogram(binwidth = 10, boundary = 0, fill = "#def5e5ff") +
  theme_minimal() +
  labs(
    title = "Days over ozone standard",
    x = "Days",
    y = NULL
  )

p2 <- full_data %>% 
  mutate(pm_standard = days_over_pm_standard/100 * 365) %>% 
  ggplot(aes(pm_standard)) +
  geom_histogram(binwidth = 10, boundary = 0, fill = "#ed6925") +
  theme_minimal() +
  labs(
    title = "Days over PM 2.5 standard",
    x = "Days",
    y = NULL
  )

p1 + p2
```

Given that the distribution is so heavily skewed right, I was interested to see the distribution of the days over the ozone and PM 2.5 standards across the US. Although most of the data is missing, it is clear that Southern California has high levels of ozone pollution and Central California has high levels of PM 2.5 pollution. For PM 2.5, the days over the PM 2.5 standard aligns with the California wildfire incident map in 2018.[^8]

[^8]: [CalFire 2018 Incident Archive](https://www.fire.ca.gov/incidents/2018)

```{r}
#| label: fig-map-days-over
#| fig-cap: Distribution of days over ozone and PM 2.5 pollution across the United States, excluding Hawaii and Alaska

p3 <- full_data %>% 
  ggplot(aes(fill = log(days_over_o3_standard), geometry = geometry)) +
  geom_sf() +
  coord_sf(
    xlim = c(-125, -65), 
    ylim = c(20, 50)
  ) + 
  theme_void() + 
  scale_fill_viridis("Log of days over\nozone standard", option = "mako") +
  labs(title = "Distribution of ozone pollution") +
  theme(legend.position = "bottom")

p4 <- full_data %>% 
  mutate(pm_standard = days_over_pm_standard/100 * 365) %>% 
  ggplot(aes(fill = log(pm_standard), geometry = geometry)) +
  geom_sf() +
  coord_sf(
    xlim = c(-125, -65), 
    ylim = c(20, 50)
  ) + 
  theme_void() + 
  scale_fill_viridis("Log of days over\nPM 2.5 standard", option = "inferno") +
  labs(title = "Distribution of PM 2.5 pollution") +
  theme(legend.position = "bottom")

p3 + p4
```

@fig-days-over-relationship shows the relationship between the days over the ozone and PM 2.5 standard. There is a positive relationship between the two air quality indicators, indicating that counties with worse ozone pollution generally also have worse PM 2.5 pollution. This is consistent with research about the sources of ozone and PM 2.5 pollution, as they can both originate from nitrogen oxides from power plants, industrial pollution, and automobiles.[^6]

However, there are a large number of counties that report having 0 days over the PM 2.5 standard while having several days over the ozone standard and several counties that report having 0 days over the ozone standard while having several days over the PM 2.5 standard. This is also consistent with research showing that these pollutants also have sources that produce one pollutant, but not the other. For example, construction sites, unpaved roads, fields, smokestacks and fires produce PM 2.5 pollution, but not ozone pollution.[^7]

[^6]: [Ground-level Ozone Basics](https://www.epa.gov/ground-level-ozone-pollution/ground-level-ozone-basics#formation) and [Particulate Matter (PM) Basics](https://www.epa.gov/pm-pollution/particulate-matter-pm-basics)

[^7]: [Particulate Matter (PM) Basics](https://www.epa.gov/pm-pollution/particulate-matter-pm-basics)

```{r}
#| label: fig-days-over-relationship
#| fig-cap: Relationship between days over PM 2.5 standard and days over ozone standards excluding outliers (over 50 days over one or both standards).

full_data %>% 
  mutate(pm_standard = days_over_pm_standard/100 * 365) %>% 
  ggplot(aes(days_over_o3_standard, pm_standard)) +
  geom_jitter() +
  geom_smooth(method = lm, se = FALSE) +
  lims(
    x = c(0, 50),
    y = c(0, 50)
  ) +
  theme_minimal() +
  labs(
    title = "Days over PM 2.5 standard vs days over ozone standard",
    x = "Days ozone standard",
    y = "Days over PM 2.5 standard"
  )
```

The other group of air quality indicators I was interested in were benzene, formaldehyde, acetaldehyde, carbon tetrachloride, and 1,3-butadiene concentrations. @fig-pollutants shows the distribution of these air pollutants. Benzene, formaldehyde, acetaldehyde, and 1,3-butadiene are skewed right, indicating that there are several counties that have unusually high levels of these pollutants. This is expected, as counties with usually high industrial pollution would cause this distribution. However, carbon tetrachloride is skewed left, indicating that there are several counties that have unusually low levels of these pollutants. One reason that this distribution may differ from the others is that carbon tetrachloride is not naturally occuring, while the other pollutants are. Thus counties with usually low levels of carbon tetrachloride may be counties that have never had high levels of carbon tetrachloride exposure.[^8]

[^8]: [Benzene](https://www.atsdr.cdc.gov/sites/toxzine/benzene_toxzine.html), [Public Health Statement for Formaldehyde](https://wwwn.cdc.gov/TSP/PHS/PHS.aspx?phsid=218&toxid=39), [Acetaldehyde](https://ntp.niehs.nih.gov/ntp/roc/content/profiles/acetaldehyde.pdf), [Where Is Carbon Tetrachloride Found?](https://www.atsdr.cdc.gov/csem/carbon-tetrachloride/where_found.html), [Public Health Statement for 1,3-Butadiene](https://wwwn.cdc.gov/TSP/PHS/PHS.aspx?phsid=457&toxid=81#bookmark02)


```{r}
#| label: fig-pollutants
#| fig-cap: Distribution of five air pollutants

p5 <- full_data %>% 
  ggplot(aes(pollutant_benzene)) +
  geom_histogram(fill = "#f0f921") +
  theme_minimal() +
  labs(
    title = "Benzene",
    x = "Concentration (µg/m3)",
    y = NULL
  )

p6 <- full_data %>% 
  ggplot(aes(pollutant_formaldehyde)) +
  geom_histogram(fill = "#f89540") +
  theme_minimal() +
  labs(
    title = "Formaldehyde",
    x = "Concentration (µg/m3)",
    y = NULL
  )

p7 <- full_data %>% 
  ggplot(aes(pollutant_acetaldehyde)) +
  geom_histogram(fill = "#cc4778") +
  theme_minimal() +
  labs(
    title = "Acetaldehyde",
    x = "Concentration (µg/m3)",
    y = NULL
  )

p8 <- full_data %>% 
  ggplot(aes(pollutant_carbon_tetrachloride)) +
  geom_histogram(fill = "#7e03a8") +
  theme_minimal() +
  labs(
    title = "Carbon Tetrachloride",
    x = "Concentration (µg/m3)",
    y = NULL
  )

p9 <- full_data %>% 
  ggplot(aes(pollutant_1_3_butadiene)) +
  geom_histogram(fill = "#0d0887") +
  theme_minimal() +
  labs(
    title = "1,3-Butadiene",
    x = "Concentration (µg/m3)",
    y = NULL
  )

(p5 + p6 + p7) / (p8 + p9)
```

Then, I explored how these five air pollutants were correlated with each other. @fig-pollutants-corr shows a correlation matrix of these air pollutants. Formaldehyde and acetaldehyde are highly correlated with each other, while the rest of the pollutants were somewhat or barely correlated with each other. Carbon tetrachloride and benzene are somewhat correlated, and 1,3-butadiene is somewhat correlated with both formaldehyde and acetaldehyde. Benzene is barely correlated with formaldehyde and acetaldehyde. Correlation between these pollutants indicate similar sources of pollution that emit multiple pollutants at the same time. 

```{r}
#| label: fig-pollutants-corr
#| fig-cap: Correlation matrix of five air pollutants

full_data %>% 
  st_drop_geometry() %>% 
  select(contains("pollutant")) %>% 
  rename_with(~str_remove(., "(pollutant_)"), everything()) %>%
  rename_with(~str_to_title(.), everything()) %>% 
  ggcorr(
    hjust = 0.6,
    geom = "circle",
    max_size = 20
  )  
```

After exploring how these five pollutants were correlated with each other, I wanted to see if they were correlated with ozone and PM 2.5 pollution. @fig-indicators-corr shows that ozone and PM 2.5 pollution are not particularly correlated with the other 5 pollutants. This is likely because the five chemicals are nearly striclty from industrial pollution, while ozone and PM 2.5 pollution can have significant non-industrial sources, such as from automobiles.

```{r}
#| label: fig-indicators-corr
#| fig-cap: Correlation matrix of all air quality indicators

full_data %>% 
  select(contains("pollutant") | contains("days")) %>% 
  st_drop_geometry() %>% 
  rename_with(~str_remove(., "(pollutant_)?(days_over_)?"), everything()) %>%
  rename_with(~str_to_title(.), everything()) %>% 
  ggcorr(
    hjust = 0.7,
    geom = "circle",
    max_size = 15,
    size = 3
  )
```

Upon bivariate analysis between air quality indicators and environmental quality indicators, I decided not to move forward with analysis including environmental indicators because they were not particularly predictive of air quality. For example, I had originally suspected that the percent of population living near a highway would be predictive of ozone levels, however, @fig-environmental shows that it is not. This lack of relationship between environmental quality and air quality suggested that continuing to explore indicators of environmental quality would not help me answer my three main questions.

```{r}
#| label: fig-environmental
#| label: The relationship between the days over ozone standard and the percent of people living within 150 M of a highway is an example of how environmental quality indicators were not particularly predictive of air quality indicators.

full_data %>% 
  ggplot(aes(highway_living, days_over_o3_standard)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  coord_cartesian(ylim = c(0, 50)) +
  theme_minimal() +
  labs(
    title = "Days over ozone standard vs population living near a highway",
    x = "Percent of people living within 150 M of a highway",
    y = "Days over ozone standard"
  )
```

## Lung disease and air quality indicators

Once I had an understanding of how the air quality indicators were related to each other, I was interested in seeing how air pollution and various lung diseases were related.

@fig-ed-asthma shows that although ozone and PM 2.5 pollution are known to aggravate lung diseases such as asthma, there is not particularly clear relationship between emergency department visits for asthma and ozone or PM 2.5 pollution.[^9] It is possible that given better predictions and access to air quality information online, individuals with asthma are better able to avoid long exposures to high ozone and PM 2.5 levels, allowing them to avoid aggravating their asthma. 

[^9]: [Ground-level Ozone Basics](https://www.epa.gov/ground-level-ozone-pollution/ground-level-ozone-basics#effects), [Health and Environmental Effects of Particulate Matter (PM)](https://www.epa.gov/pm-pollution/health-and-environmental-effects-particulate-matter-pm)

```{r}
#| label: fig-ed-asthma
#| label: The crude rate of emergency deartment visits for asthma per 10 K population as a function of days over the ozone and PM 2.5 standard. 

p10 <- full_data %>% 
  ggplot(aes(days_over_o3_standard, asthma_ed_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE)  +
  coord_cartesian(
    x = c(0, 20),
    y = c(0, 150)
  ) +
  labs(
    title = "Days over ozone standard",
    x = "Days over ozone standard",
    y = "Crude emergency department visits"
  ) +
  theme_minimal()

p11 <- full_data %>% 
  ggplot(aes(days_over_pm_standard, asthma_ed_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  coord_cartesian(
    x = c(0, 20),
    y = c(0, 150)
  ) +
  labs(
    title = "Days over PM 2.5 standard",
    x = "Days over PM 2.5 standard",
    y = "Crude emergency department visits"
  ) +
  theme_minimal()
  
p10 + p11
```

However, @fig-pollutants-asthma shows a clear positive relationship between the prevalence of asthma and exposure to the pollutants formaldehyde and acetaldehyde for both adults and children. Since the relationship between asthma and these two pollutants holds in both childhood and adulthood, I suspect that exposure to these pollutants in childhood is can be associated with the development of asthma, which is then carried into adulthood. The relationship between childhood asthma and formaldehyde exposure has been supported by various studies.[^10] 

[^10]: [Formaldehyde Exposure and Asthma in Children: A Systematic Review](https://doi.org/10.1289%2Fehp.0901143)

```{r}
#| label: fig-pollutants-asthma
#| label: The prevalence of ault and child asthma prevalence as a function of formaldehyde and acetaldehyde concentrations.


p12 <- full_data %>% 
  ggplot(aes(pollutant_formaldehyde, asthma_adult_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  labs(
    title = "Crude adult asthma prevalance vs formaldehyde",
    x = "Concentration (µg/m3)",
    y = "Crude percentage of adults with asthma"
  ) +
  theme_minimal()

p13 <- full_data %>% 
  ggplot(aes(pollutant_acetaldehyde, asthma_adult_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  labs(
    title = "Crude adult asthma prevalance vs acetaldehyde",
    x = "Concentration (µg/m3)",
    y = "Crude percentage of adults with asthma"
  ) +
  theme_minimal()

p14 <- full_data %>% 
  ggplot(aes(pollutant_acetaldehyde, asthma_child_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  labs(
    title = "Crude child asthma prevalance vs formaldehyde",
    x = "Concentration (µg/m3)",
    y = "Crude percentage of children with asthma"
  ) +
  theme_minimal()

p15 <- full_data %>% 
  ggplot(aes(pollutant_acetaldehyde, asthma_child_crude)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) +
  labs(
    title = "Crude child asthma prevalance vs acetaldehyde",
    x = "Concentration (µg/m3)",
    y = "Crude percentage of children with asthma"
  ) +
  theme_minimal()

(p12 + p13) / (p14 + p15)
```





# Appendix

## A. Identifying sociodemographic vulnerabilities
